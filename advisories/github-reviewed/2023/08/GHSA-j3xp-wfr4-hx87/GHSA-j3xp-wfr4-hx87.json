{
  "schema_version": "1.4.0",
  "id": "GHSA-j3xp-wfr4-hx87",
  "modified": "2023-08-03T16:30:52Z",
  "published": "2023-08-03T16:30:52Z",
  "aliases": [
    "CVE-2023-38497"
  ],
  "summary": "Cargo not respecting umask when extracting crate archives",
  "details": "The Rust Security Response WG was notified that Cargo did not respect the umask when extracting crate archives on UNIX-like systems. If the user downloaded a crate containing files writeable by any local user, another local user could exploit this to change the source code compiled and executed by the current user.\n\nThis vulnerability has been assigned CVE-2023-38497.\n\n## Overview\n\nIn UNIX-like systems, each file has three sets of permissions: for the user owning the file, for the group owning the file, and for all other local users. The \"[umask][1]\" is configured on most systems to limit those permissions during file creation, removing dangerous ones. For example, the default umask on macOS and most Linux distributions only allow the user owning a file to write to it, preventing the group owning it or other local users from doing the same.\n\nWhen a dependency is downloaded by Cargo, its source code has to be extracted on disk to allow the Rust compiler to read as part of the build. To improve performance, this extraction only happens the first time a dependency is used, caching the pre-extracted files for future invocations.\n\nUnfortunately, it was discovered that Cargo did not respect the umask during extraction, and propagated the permissions stored in the crate archive as-is. If an archive contained files writeable by any user on the system (and the system configuration didn't prevent writes through other security measures), another local user on the system could replace or tweak the source code of a dependency, potentially achieving code execution the next time the project is compiled.\n\n## Affected Versions\n\nAll Rust versions before 1.71.1 on UNIX-like systems (like macOS and Linux) are affected. Note that additional system-dependent security measures configured on the local system might prevent the vulnerability from being exploited.\n\nUsers on Windows and other non-UNIX-like systems are not affected.\n\n## Mitigations\n\nWe recommend all users to update to Rust 1.71.1, which will be released later today, as it fixes the vulnerability by respecting the umask when extracting crate archives. If you build your own toolchain, patches for 1.71.0 source tarballs are [available here][2].\n\nTo prevent existing cached extractions from being exploitable, the Cargo binary included in Rust 1.71.1 or later will purge the caches it tries to access if they were generated by older Cargo versions.\n\nIf you cannot update to Rust 1.71.1, we recommend configuring your system to prevent other local users from accessing the Cargo directory, usually located in `~/.cargo`:\n\n```\nchmod go= ~/.cargo\n```\n\n## Acknowledgments\n\nWe want to thank Addison Crump for responsibly disclosing this to us according to the [Rust security policy][3].\n\nWe also want to thank the members of the Rust project who helped us disclose the vulnerability: Weihang Lo for developing the fix; Eric Huss for reviewing the fix; Pietro Albini for writing this advisory; Pietro Albini, Manish Goregaokar and Josh Stone for coordinating this disclosure; Josh Triplett, Arlo Siemen, Scott Schafer, and Jacob Finkelman for advising during the disclosure.\n\n[1]: https://en.wikipedia.org/wiki/Umask\n[2]: https://github.com/rust-lang/wg-security-response/tree/main/patches/CVE-2023-38497\n[3]: https://www.rust-lang.org/policies/security",
  "severity": [
    {
      "type": "CVSS_V3",
      "score": "CVSS:3.1/AV:L/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:N"
    }
  ],
  "affected": [
    {
      "package": {
        "ecosystem": "crates.io",
        "name": "cargo"
      },
      "ranges": [
        {
          "type": "ECOSYSTEM",
          "events": [
            {
              "introduced": "0"
            },
            {
              "fixed": "0.72.2"
            }
          ]
        }
      ],
      "database_specific": {
        "last_known_affected_version_range": "<= 0.72.1"
      }
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/rust-lang/cargo/security/advisories/GHSA-j3xp-wfr4-hx87"
    },
    {
      "type": "ADVISORY",
      "url": "https://nvd.nist.gov/vuln/detail/CVE-2023-38497"
    },
    {
      "type": "WEB",
      "url": "https://github.com/rust-lang/cargo/pull/12443"
    },
    {
      "type": "WEB",
      "url": "https://github.com/rust-lang/cargo/commit/d78bbf4bde3c6b95caca7512f537c6f9721426ff"
    },
    {
      "type": "WEB",
      "url": "https://en.wikipedia.org/wiki/Umask"
    },
    {
      "type": "PACKAGE",
      "url": "https://github.com/rust-lang/cargo"
    },
    {
      "type": "WEB",
      "url": "https://github.com/rust-lang/wg-security-response/tree/main/patches/CVE-2023-38497"
    },
    {
      "type": "WEB",
      "url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/QGKE6PGM4HIQUHPJRBQAHMELINSGN4H4"
    },
    {
      "type": "WEB",
      "url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/QMEXGUGPW5OBSQA6URTBNDSU3RAEFOZ4"
    },
    {
      "type": "WEB",
      "url": "https://www.rust-lang.org/policies/security"
    }
  ],
  "database_specific": {
    "cwe_ids": [
      "CWE-278",
      "CWE-732"
    ],
    "severity": "HIGH",
    "github_reviewed": true,
    "github_reviewed_at": "2023-08-03T16:30:52Z",
    "nvd_published_at": "2023-08-04T16:15:10Z"
  }
}